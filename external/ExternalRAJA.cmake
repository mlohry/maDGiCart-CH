#########################################################
message( STATUS "Building external RAJA project.")
#########################################################

set(RAJA_URL https://github.com/LLNL/RAJA/releases/download/v0.14.0/RAJA-v0.14.0.tar.gz)
set(RAJA_MD5 1e8682504f0c44301f56c116c14487c2)


if(MADG_USE_SERIAL OR MADG_USE_OPENMP)
    ExternalProject_Add(
        raja_external
        URL ${RAJA_URL}
        URL_MD5 ${RAJA_MD5}

        SOURCE_DIR ${CMAKE_BINARY_DIR}/external/raja/
        BINARY_DIR ${CMAKE_BINARY_DIR}/external/raja-build/
        INSTALL_DIR ${EXTERNAL_INSTALL_DIR}
        CMAKE_ARGS -DCMAKE_INSTALL_PREFIX=${EXTERNAL_INSTALL_DIR} -DENABLE_CUDA=${MADG_USE_CUDA} -DENABLE_OPENMP=${MADG_USE_OPENMP} -DENABLE_HIP=${MADG_USE_HIP} -DCMAKE_CUDA_STANDARD=14 -DRAJA_ENABLE_TESTS=Off -DRAJA_ENABLE_EXAMPLES=Off -DRAJA_ENABLE_EXERCISES=Off -DCUDA_TOOLKIT_ROOT_DIR=${CUDA_TOOLKIT_ROOT_DIR} -DCMAKE_CUDA_COMPILER=${CMAKE_CUDA_COMPILER}
    )
elseif(MADG_USE_CUDA)
    ExternalProject_Add(
            raja_external
            URL ${RAJA_URL}
            URL_MD5 ${RAJA_MD5}

            SOURCE_DIR ${CMAKE_BINARY_DIR}/external/raja/
            BINARY_DIR ${CMAKE_BINARY_DIR}/external/raja-build/
            INSTALL_DIR ${EXTERNAL_INSTALL_DIR}
            CMAKE_ARGS -DCMAKE_INSTALL_PREFIX=${EXTERNAL_INSTALL_DIR} -DENABLE_CUDA=ON -DENABLE_OPENMP=OFF -DENABLE_HIP=OFF -DCMAKE_CUDA_STANDARD=14 -DRAJA_ENABLE_TESTS=Off -DRAJA_ENABLE_EXAMPLES=OFF -DRAJA_ENABLE_EXERCISES=OFF -DCUDA_TOOLKIT_ROOT_DIR=${CUDA_TOOLKIT_ROOT_DIR} -DCMAKE_CUDA_COMPILER=${CMAKE_CUDA_COMPILER}
    )
elseif(MADG_USE_HIP)
    ExternalProject_Add(
            raja_external
            URL ${RAJA_URL}
            URL_MD5 ${RAJA_MD5}

            SOURCE_DIR ${CMAKE_BINARY_DIR}/external/raja/
            BINARY_DIR ${CMAKE_BINARY_DIR}/external/raja-build/
            INSTALL_DIR ${EXTERNAL_INSTALL_DIR}
            CMAKE_ARGS -DCMAKE_INSTALL_PREFIX=${EXTERNAL_INSTALL_DIR} -DENABLE_CUDA=OFF -DENABLE_OPENMP=OFF -DENABLE_HIP=ON -DRAJA_ENABLE_TESTS=Off -DRAJA_ENABLE_EXAMPLES=OFF -DRAJA_ENABLE_EXERCISES=OFF -DCMAKE_HIP_ARCHITECTURES=gfx906
    )
endif()

set(RAJA_LIBRARIES
        ${CMAKE_BINARY_DIR}/external_install/lib/libRAJA.a
        CACHE FILEPATH "")
